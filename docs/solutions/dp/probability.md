# 概率 DP

## P1654 OSU!

[题目链接](https://www.luogu.com.cn/problem/P1654)

大意：一个长度为 n $(n\leq 10^5)$ 的 01 串，每一位上出现 1 有一个特定的概率，连续的 $x$ 个 $1$ 可以贡献  $x^3$ 的分数，求分数和的期望。

解法：对于任意的期望 $S+x^3$，在其添加一个 $1$ 后，期望变为 $S+x^3+3\cdot x^2+3\cdot x+1$。**变化的量**为 $3\cdot x^2+3\cdot x + 1$，且与先前积攒的期望值无关，仅与该位 $x^2$，$x$ 的期望值有关。因而可以列式求解，维护答案、二次项、一次项的期望值 $a,b,c$，则 $c_{i}=(c_{i-1}+1)\cdot p_i$，$b_i=(b_{i-1}+2\cdot c_{i-1}+1)\cdot p_i$，$a_{i}=a_{i-1}+(3\cdot b_{i-1}+3\cdot c_{i-1}+1)\cdot p_i$，注意维护答案与维护二次项期望时乘概率方式上的不同。

??? note "参考代码"
	```cpp linenums="1"
	--8<-- "code/P1654.cpp"
	```

## P2059 \[JLOI2013\]卡牌游戏

[题目链接](https://www.luogu.com.cn/problem/P2059)

大意：n $(1\leq n \leq 50)$ 个人围成一圈玩游戏。从第一个玩家开始，每一回合从 m $(1\leq m \leq 50, 1\leq a_m\leq 50)$ 张卡片中抽取一张卡片，并淘汰掉从该人开始数第 $a_m$ 个人，让被淘汰者后面的人继续下一回合，直到还剩下一个玩家为止。问每一个人获胜的概率。

解法：注意到每一回合满足无后效性，整个游戏满足**旋转对称性**。也就是说对于 $i$ 个人，从该人开始数的第 $j$ 个人获胜的概率是一个定值，而且可以直接由 $i-1$ 人的数据得到。设 $f_{i,j}$ 为 $i$ 个人的游戏，从他开始数第 $j$ 人获胜的概率，则：

$$
f_{i,j}=\sum_{k=1}^{m}\left\{
\begin{aligned}
f_{i-1,j-(a_k-1)\bmod i - 1}&, (a_k-1) \bmod{i} + 1 < j \\
0&, (a_k-1)\bmod{j} + 1 = j \\
f_{i-1,i + j-(a_k-1)\bmod i - 1}&, (a_k-1)\bmod{i} + 1 > j
\end{aligned}
\right.
$$
