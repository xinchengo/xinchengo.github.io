# 概率 DP

## P1654 OSU!

[题目链接](https://www.luogu.com.cn/problem/P1654)

大意：一个长度为 n $(n\leq 10^5)$ 的 01 串，每一位上出现 1 有一个特定的概率，连续的 $x$ 个 $1$ 可以贡献  $x^3$ 的分数，求分数和的期望。

解法：对于任意的期望 $S+x^3$，在其添加一个 $1$ 后，期望变为 $S+x^3+3\cdot x^2+3\cdot x+1$。变化的量为 $3\cdot x^2+3\cdot x + 1$，且与先前积攒的期望值无关，仅与该位 $x^2$，$x$ 的期望值有关。因而可以列式求解，维护答案、二次项、一次项的期望值 $a,b,c$，则 $c_{i}=(c_{i-1}+1)\cdot p_i$，$b_i=(b_{i-1}+2\cdot c_{i-1}+1)\cdot p_i$，$a_{i}=a_{i-1}+(3\cdot b_{i-1}+3\cdot c_{i-1}+1)\cdot p_i$，注意维护答案与维护二次项期望时乘概率方式上的不同。

??? note "参考代码"
	```cpp linenums="1"
	--8<-- "code/P1654.cpp"
	```