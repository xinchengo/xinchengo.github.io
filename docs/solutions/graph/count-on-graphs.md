# 图上统计专题
## 树上统计
### 问题 1
给定一个有 n 个节点的**不带权树** G，求 G 上所有长度**等于** k 的简单路径数量。

[CF161D Distance in Tree](https://www.luogu.com.cn/problem/CF161D)

#### 法 1：树形 DP
可以应用树形 DP 求解这类题目。对于每个点，维护其子树上距离为 k 的点的数量，设 $f(u,i)$ 为在点 u 的子树上，与 u 距离为 i $(0\leq i\leq k)$ 的点的数目。则答案为: 
$$
\sum_{u=1}^{n}(f(u,k)+\frac{1}{2} \times \sum_{x=1}^{k-1}(f(v,x-1)\times(f(u,k-x)-f(v,k-x-1)) ))
$$
实际实现只需要一遍 DFS，在枚举子节点的过程中将之前子树的信息和当前子树的信息相乘，不需要对系数 $\frac{1}{2}$ 进行处理。 该方法的时间复杂度是 $O(n\cdot k)$，空间复杂度为 $O(n\cdot k)$，只适用于 k 很小的情况。

??? note "参考代码"
	```cpp linenums="1"
	--8<-- "code/CF161D.cpp"
	```

#### 法 2：启发式合并（重链剖分优化）
上述方法的瓶颈主要在于 k，可以考虑只使用一个数组（dis）记录各深度点的数量。这种方法结合了重链剖分的思想。具体见[[dsu-on-tree#_2|此文章]]。时间复杂度是 $O(n \log{n})$，空间复杂度是 $O(\text{树的深度})$。

??? note "参考代码"
	```cpp linenums="1"
	--8<-- "code/alternative/CF161D.cpp"
	```

#### 法 3：长链剖分优化

==（待补）==
#### 法 4：点分治

==（待补）==
### 问题 2
给定一个有 n 个节点的**带权树** G，求 G 上所有长度**等于** k 的简单路径数量。

==（待补）==
### 问题 3
给定一个有 n 个节点的**不带权树** G，求 G 上所有长度**小于等于** k 的简单路径数量。

==（待补）==
### 问题 4
给定一个有 n 个节点的**带权树** G，求 G 上所有长度**小于等于** k 的简单路径数量。

==（待补）==