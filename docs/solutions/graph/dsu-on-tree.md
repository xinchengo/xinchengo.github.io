# 树上启发式合并

## 概念
树上启发式合并可以通过只记录重子节点的信息，得到时间和空间复杂度的平衡。

树上启发式合并的基本思路如下：

1.  遍历 u 的轻子树，此时数组一定是空的，计算答案，计算完后清空数组。
2. 遍历 u 的重子树，计算答案，并记录数组。
3. 记录 u 的轻子树。

## CF600E Lomsat gelral
[题目链接](https://www.luogu.com.cn/problem/CF600E)
	
大意：给定一个 n 个节点的树 $(n \leq 10^5)$ ，每个节点都有一个颜色，求每个节点的子树上出现次数最多的颜色的编号和（可能有多种颜色出现次数最多）。

解法：由于无法记录每个点的子树每一颜色的出现次数，我们考虑使用一个数组，先遍历所有的轻儿子节点形成的子树，统计答案但是不保留数据，然后遍历重儿子，统计答案并且保留数据，最后再遍历轻儿子以及父节点，合并重儿子统计过的答案。

??? note "参考代码"
	```cpp linenums="1"
	--8<-- "code/CF600E.cpp"
	```

该题是记录出现次数题目的代表。

## CF208E Blood Cousins
[题目链接](https://www.luogu.com.cn/problem/CF208E)

大意：给你一片 n 个节点 $(n \leq 10^5)$ 的树，每次询问一个点与多少个点拥有共同的 K 级祖先。

解法：本题同问以给定点为根，深度为 k 的点的个数减一。维护一个 dis 数组记录给定深度的点的个数，方法同上。

??? note "参考代码"
	```cpp linenums="1"
	--8<-- "code/CF208E.cpp"
	```

该题是记录深度题目的代表。

## 参考资料
[^note1]: [木每立兄豪《dsu on tree(树上启发式合并)算法总结+习题》](https://blog.csdn.net/qq_43472263/article/details/104150940)


